<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width">
      
        <title>界面</title>
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link  href="themes/Site.css" rel="stylesheet"/>
	    <link rel="stylesheet" href="http://122.114.38.213:8080/arcgis_js_api/library/3.17/3.17/dijit/themes/claro/claro.css">
    	<link rel="stylesheet" href="http://122.114.38.213:8080/arcgis_js_api/library/3.17/3.17/esri/css/esri.css">

		<link href="themes/menu.css" rel="stylesheet" />
		<script src="Scripts/jquery-3.2.1.min.js"></script>
		<script src="Scripts/vue.js"></script>
		<script src="Scripts/vue-resource.js"></script>
		<script src="Scripts/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://122.114.38.213:8080/arcgis_js_api/library/3.17/3.17/init.js"></script>
		<script type="text/javascript"  src="Scripts/json2.js"></script>
        <script src="Scripts/QyTech/nav4.js"></script>
        <script src="Scripts/QyTech/Sonic.js"></script>
         
		<!--<script type="text/javascript" src="/js/Qytech/myArc.js"></script>-->
       <style> 
           .layerdisp{
                background-color:#33ffcc !important;
                z-index :200;
            }
           .layernodisp{
                background-color:yellow;
                   z-index :200;
            }

         </style>
	<script>
	    var WebServer = '';
	    //console.log(window.location.host);
		//矢量图
		var MapServer='http://122.114.38.213/arcgis/rest/services/WTMap/TD_SpatialServerTest/MapServer';
		var VectorLayer;
		//栅格图
		var GridMapServer = 'http://122.114.38.213/arcgis/rest/services/WTMap/WTService/MapServer';
		var GridLayer;

		var LoginUserName='admin';
		var bsUser={};
		var bsUserRightCode=''

		var map;
		var setLayers;
		var CurrLayerName;
		var Djlayers=[];
		
		//规则：所有菜单项和按钮项都给定统一的编号规则，方便将来统一处理相互关系
		// 101:镇查询 102：村查询 
		//叠加，查询合成一个：单击叠加或取消，叠加则自动设为查询编辑状态
		//301：历年批次查询 302：城市规划查询 303 土地现状查询 304 房屋查询
		//401：企业查询定位
		var CurrFunItem=303;
		var bolClickMap = true;//默认土地现状查询
		var IsReCenter = false;
		
	
        var VectorVisibleLayerDefault=[];
		VectorVisibleLayerDefault.push(0);
		VectorVisibleLayerDefault.push(1);
		VectorVisibleLayerDefault.push(2);
		//VectorVisibleLayerDefault.push(6);//parent
		//VectorVisibleLayerDefault.push(11);//parent
		VectorVisibleLayerDefault.push(16);
		VectorVisibleLayerDefault.push(17);
		VectorVisibleLayerDefault.push(18);
		//VectorVisibleLayerDefault.push(19);//parent


		var VectorVisibleLayer = VectorVisibleLayerDefault.concat([]);
		VectorVisibleLayer.push(20);
		
		var GridVisibleLayerDisp=false;
		Djlayers.push('土地现状');


		function GetGridMapAddrByOrgCode(orgcode){
			if (orgcode.length>=12){//320507100001
				return 'http://122.114.38.213/arcgis/rest/services/wd/cun'+orgcode+'/MapServer';
			}
			else{
				return 'http://122.114.38.213/arcgis/rest/services/WTMap/WTService/MapServer';
			}
		}
																		
		function Layer(LayerName,EditView,QueryFName,LayerQueryIndex,FunId){
			var olayer = new Object;
			olayer.LayerName = LayerName;
			olayer.EditView = EditView;
			olayer.QueryFName = QueryFName;
			olayer.LayerQueryIndex = LayerQueryIndex;
			olayer.FunId=FunId;
			return olayer;
		}
        
		var zjLayer = Layer("镇界","","行政镇代码",0,101);
		var cjLayer = Layer("村界","","行政村代码",1,102);
		var tdxzLayer = Layer("土地现状","tdxzWebView","地块编码",20,201);
		var tdghLayer = Layer("土地规划","tdghWebView","地块编号",11,202);
		var csghLayer = Layer("城市规划","csghWebView","地块编码",7,203);
		var lnpcLayer = Layer("历年批次","lnpcWebView","地块编码",4,204);
		var fwjzLayer = Layer("房屋","fwjzWebView","建筑编号",5,205);
	
		var dic_Layer = new Array();
		dic_Layer['镇界']=zjLayer;
		dic_Layer['村界']=cjLayer;
		dic_Layer['土地现状']=tdxzLayer;
		dic_Layer['土地规划']=tdghLayer;
		dic_Layer['城市规划']=csghLayer;
		dic_Layer['历年批次']=lnpcLayer;
		dic_Layer['房屋'] = fwjzLayer;

		var dic_LayerDjBtn = new Array();
		dic_LayerDjBtn['土地现状'] = 'btnTdxz';
		dic_LayerDjBtn['土地规划'] = 'btnTdgh';
		dic_LayerDjBtn['城市规划'] = 'btnCsgh';
		dic_LayerDjBtn['历年批次'] = 'btnLnpc';
		dic_LayerDjBtn['房屋'] = 'btnFw';
		dic_LayerDjBtn['影像'] = 'btnYx';

	
		// var dic_Menu2ServerAddr=new Array();
		// dic_Menu2ServerAddr['101']=WebServer+'/showview/resultview';
		// dic_Menu2ServerAddr['102']=WebServer+'/showview/resultview';
		
		function QueryLayerInfo(LayerName,ObjCode){
			var olayer = new Object;
			olayer.LayerName = LayerName;
			olayer.ObjCode = ObjCode;
			return olayer;
		}
        function DjLayerAddrConf(LayerName,Layerindexs){
			var olayer = new Object;
			olayer.LayerName = LayerName;
			olayer.Layerindexs = Layerindexs;
			return olayer;
		}
        function initMap() {
            require([
				"esri/map",
                'esri/geometry/Extent',
				"esri/layers/ArcGISDynamicMapServiceLayer",
				"esri/dijit/OverviewMap",
				"dojo/parser", "dojo/dom",
				"dijit/layout/BorderContainer",
				"dijit/layout/ContentPane",
				"esri/tasks/FindTask",
				"esri/tasks/FindParameters",
				"esri/tasks/query",
				"esri/tasks/IdentifyTask",
				"esri/tasks/IdentifyParameters",
				"esri/toolbars/draw",
                "esri/symbols/SimpleMarkerSymbol",
				"esri/symbols/SimpleFillSymbol",
				"esri/symbols/SimpleLineSymbol",
				"esri/graphic",
				"dojo/colors",
				"dojo/domReady!"
            ],
				function (Map, Extent, ArcGISDynamicMapServiceLayer, OverviewMap, parser
						, on
						, dom
						, IdentifyTask, IdentifyParameters
						, draw, SimpleMarkerSymbol, SimpleFillSymbol, SimpleLineSymbol, Graphic, Color) {
				    //parser.parse();
				    var options = { logo: false, center: [27478, 18538], zoom: 4 }; //var MyMap = new esri.Map(mapContainer, options);
				    map = new Map("map", options);
				    var location = new esri.geometry.Point(1, 1, map.spatialReference)
				    map.centerAndZoom(location, 4)

				    VectorLayer = new ArcGISDynamicMapServiceLayer(MapServer);
				    map.addLayer(VectorLayer, 1);


				    GridMapServer = GetGridMapAddrByOrgCode('');
				    GridLayer = new ArcGISDynamicMapServiceLayer(GridMapServer);
				    map.addLayer(GridLayer, 0);

				    setLayers(VectorLayer, VectorVisibleLayer);
				    setLayers(GridLayer, []);

				    //设置地图的视图范围  
				    //if (i == 0) {
				    //    showExtent = fea.geometry.getExtent();
				    //} else {
				    //    showExtent = showExtent.union(fea.geometry.getExtent());
				    //}33153.124962979324 YMin: 50487.12717136495 XMax: 40792.98399269738 YMax: 62595.93286652488
				   // var extent = new esri.geometry.Extent(xmin, ymin, xmax, ymax, new esri.SpatialReference({ wkid: 4326 }));


				    //n: 33152.824655436445 YMin: 50487 XMax: 40792.175344563555 YMax: 62595
				    var startExtent = new Extent(33153, 50487, 40792, 62595, map.spatialReferenc);
				    var startExtent = new Extent(33153, 50487, 40792, 62595, new esri.SpatialReference({ wkid: 4214 }));
				    map.setExtent(startExtent);

				  
				    map.on("click", mapClick);
				    //map.on("extent-change", showExtent);
				}
			);
        }

        function showExtent(ext) {
            var extentString = "";
            extentString = "XMin: " + ext.extent.xmin +
              " YMin: " + ext.extent.ymin +
              " XMax: " + ext.extent.xmax +
              " YMax: " + ext.extent.ymax +
              "SR:" + ext.extent.spatialReference.wkt;
            console.log(extentString);
        }

		setLayers = function(layer,vis){
			layer.setVisibleLayers(vis);
		}
		
        //图层显示控制
		function btnDispLayer(btnid, LayerName) {
		    bolClickMap = false;
		    DispLayer(btnid, LayerName);
		}

		function DispLayer(btnid, LayerName) {
		    

		    //处理叠加
		    var LayerFwDisp = null
		    if (LayerName == '影像') {
		        GridVisibleLayerDisp = !GridVisibleLayerDisp;
		        if (GridVisibleLayerDisp == true) {
		            setLayers(GridLayer, [0]);
		            $("#" + btnid).attr("class", "btn btn-default layerdisp");
		        }
		        else {
		            setLayers(GridLayer, []);
		            $("#" + btnid).attr("class", "btn btn-default layernodisp");
		        }
		    }
		    else {
		        if (LayerName == '房屋') {
		            if (HaveValueInArray(dic_Layer[LayerName].LayerQueryIndex)==false) {
		                LayerFwDisp = true;
		                $("#" + btnid).attr("class", "btn btn-default layerdisp");

		            }
		            else {
		                LayerFwDisp = false;
		                $("#" + btnid).attr("class", "btn btn-default layernodisp");
		            }
		        }
		        else {
		            //矢量量叠加相关显示图层
		            if (Djlayers.contains(LayerName) == true) {
		                Djlayers.remove(LayerName);
		                $("#" + btnid).attr("class", "btn btn-default layernodisp");
		            }
		            else {
		                Djlayers.push(LayerName);
		                $("#" + btnid).attr("class", "btn btn-default layerdisp");
		            }
		        }
		    }



		    //然后处理整个叠加，并控制数据的显示
		    VectorVisibleLayer = VectorVisibleLayerDefault;
		    if (LayerFwDisp == true) {
		        VectorVisibleLayer.push(dic_Layer[LayerName].LayerQueryIndex);
		    }
		    else if (LayerFwDisp == false) {
		        VectorVisibleLayer.pop(dic_Layer[LayerName].LayerQueryIndex);
		    }

		    var djindex = getDjLayers();
		    VectorVisibleLayer = VectorVisibleLayer.concat(djindex);
		    setLayers(VectorLayer, VectorVisibleLayer);
		    //更改按钮css，显示方式，显示则为黄色，否则为蓝色
		    //for (var lname in dic_LayerDjBtn) {
		    //    if (lname == LayerName) {
		    //        $(btnid).css("","")
		    //    }
		    //}

		}
		function HaveValueInArray(val){
			for (i in VectorVisibleLayer){
					v=VectorVisibleLayer[i];
				if (v==val)
				{
					return true;
				}
			}
			return false;
		}

		
		function mapClick(e) {
		   if(bolClickMap==false){
				return;
			}
			//获得用户点击的地图坐标
			var point=e.mapPoint;
			
			//实例化查询参数
			var query=new  esri.tasks.Query();
			query.geometry = point;
			query.outFields = ["*"];
			query.outSpatialReference = map.spatialReference;
			query.spatialRelationship =  esri.tasks.Query.SPATIAL_REL_INTERSECTS;
			query.returnGeometry = true;
			//实例化查询对象
			
			var queryTask = new esri.tasks.QueryTask("http://122.114.38.213/arcgis/rest/services/WTMap/TD_SpatialServerTest/MapServer/"+dic_Layer[CurrLayerName].LayerQueryIndex);
			//进行查询                                
			queryTask.execute(query,showFindResult)
			
		}

		function showFindResult(queryResult){
			if (queryResult.features == 0) {
				alert("没有该元素");
				return;
			}
			try{
				for (var i = 0; i < queryResult.features.length; i++) {
					var feature = queryResult.features[0];
					//定义高亮图形的符号
					//1.定义面的边界线符号
					var outline= new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255, 0, 0]), 3);
					//2.定义面符号 
					var PolygonSymbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, outline,new dojo.Color([0, 255, 0, 1]));

					var graphic = new esri.Graphic();


				    //创建客户端图形
					graphic.setGeometry(feature.geometry);  
					//设置查询到的graphic的显示样式  
					graphic.setSymbol(PolygonSymbol);

					map.graphics.clear();
					//var graphic = new Graphic(geometry, PolygonSymbol);
					//将客户端图形添加到map中
					map.graphics.add(graphic);

					//setTimeout(function (map) {
					//    map.graphics.clear();
					//}, 1000);

					
				}
			}
			catch(e){
				alert(e);
			}

			if (CurrFunItem.substring(0,1)=='1'){
				var feature = queryResult.features[0];
				var geometry = feature.geometry;
				var dkcode = feature.attributes[dic_Layer[CurrLayerName].QueryFName];
				SpatialQuery(CurrLayerName,dkcode)
			}
			else if (CurrFunItem.substring(0,1)=='4'){
				var feature = queryResult.features[0];
				var geometry = feature.geometry;
				var dkbm = feature.attributes[dic_Layer[CurrLayerName].QueryFName];
				var url=WebServer+"/EditView/"+dic_Layer[CurrLayerName].EditView+"?id="+dkbm; 
				location.href=url;
			}
			
		}
		function SpatialQuery(LayerName,ObjCode){
			
			//var json = eval('(' + str + ')');
			var objStr = QueryLayerInfo(LayerName,ObjCode);
			//var strjson=objStr.toJSONString();
			var strjson=JSON.stringify(objStr);
			var url = WebServer + "/showview/resultview?json=" + strjson;

			ShowUrl(url);
		}

		function btnReturn() {
		    history.go(-1);
		    //$("#div3th").hide();
		    //$("#LtdPos").hide();
		    //$("#container").show();
		}
		function ShowUrl(url) {
		    location.href = url;

		    //$("#div3th").load(url);
		    //$("#LtdPos").hide();
		    //$("#container").hide();
		}

	
		//处理功能项菜单
		function MenuClick(FunItem, LayerName) {
		    $("#FunGroup1").attr("class", "off");
		    $("#FunGroup4").attr("class", "off");

		    bolClickMap = false;
			CurrFunItem=FunItem;
			if (FunItem==101){
				bolClickMap=true;
				CurrLayerName='镇界';
			}
			else if (FunItem==102){
				bolClickMap=true;
				CurrLayerName='村界';
			}
			else if (FunItem==301) {//企业定位
				SetPosVisible(true);}
			else if (FunItem.substring(0,1)==4)
			{
			    bolClickMap = true;
			    CurrLayerName = LayerName;
			    $("#FunGroup4").attr("class", "off");
			  
                ////如果该图层没有加载，则加载
			    if (!Djlayers.contains(CurrLayerName)) {
                    alert('该图层还没有显示，请先叠加图层!');
			    //    if (LayerName=="土地现状"){
			    //        DispLayer("btnTdxz", LayerName)}
			    //    else if (LayerName=="房屋"){
			    //        DispLayer("btnFw", LayerName)}
			    //    else if (LayerName=="历年批次"){
			    //        DispLayer("btnLnpc", LayerName)}
			    //    else if (LayerName=="城市规划"){
			    //        DispLayer("btnCsgh", LayerName)}
			       
			    //    //VectorVisibleLayer.push(dic_Layer[CurrLayerName].LayerQueryIndex);
			    //    //setLayers(VectorLayer, VectorVisibleLayer);
			    }
			}
		}

		//定位界面显示
		function SetPosVisible(posvisible) {
		    $("#LtdTable tr:gt(0)").remove();
		    $("#ltdname").val('');

			if (posvisible==true){
				$("#LtdPos").show();
				$("#container").hide();
			}
			else{
				$("#LtdPos").hide();
				$("#container").show();
			}

		}
	    //初始位置
		function InitPosition(flag) {
		    return;
		    console.log(flag);
		    if (IsReCenter == true)
		        return;
		    IsReCenter = true;
		    console.log('recenter');
		    var query = new esri.tasks.Query();
		    //把需要查询的底图服务加载进来  
		    var queryTask = new esri.tasks.QueryTask(MapServer + "/0");
		    //需要返回Geometry  
		    query.returnGeometry = true;
		    //需要返回的字段  
		    query.outFields = ["*"];
		    //设置查询条件，buildNo是之前DOM操作时从信息内容里取出来的  
		    //query.where = "行政镇编码 ='320507100'";
		    query.where = "OBJECTID=1";
		    //进行查询  
		    queryTask.execute(query, function (res) {
		        var fea = res.features[0];
		        //获取查询到的所有geometry的Extent用来设置查询后的地图显示  
		        var showExtent = fea.geometry.getExtent();
		        //设置地图的视图范围  
		        map.setExtent(showExtent.expand(1));

		    });
		}
		//开启定位
		function StartPosition(dkbm){

			var query = new esri.tasks.Query();  
			//把需要查询的底图服务加载进来  
			var queryTask = new esri.tasks.QueryTask(MapServer+"/20");  
			//需要返回Geometry  
			query.returnGeometry = true;  
			//需要返回的字段  
			query.outFields = ["*"];  
			//设置查询条件，buildNo是之前DOM操作时从信息内容里取出来的  
			query.where = "地块编码 ='"+dkbm+"'";  
			//进行查询  
			queryTask.execute(query,function(res){  
				SetPosVisible(false);
				var showExtent;  
				for(var i=0;i<res.features.length;i++){  
					var fea = res.features[i];  
					var point = fea.geometry.getExtent().getCenter();  
					
					//设置信息模板infoWindow  
					map.infoWindow.setTitle("企业信息");  
					map.infoWindow.setContent("<p>"+fea.attributes["用地单位名称"]+"</p>");  
					//把信息模板显示在中心点上  
					map.infoWindow.show(point);  
					//查询结果样式  
					try{
						var symbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,  
							new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0,0.8]),1),  
							new dojo.Color([125,125,125,0.35]));  
					}
					catch(e)
					{
						alert(e);
					}
					var graphic = new esri.Graphic();  
					graphic.setGeometry(fea.geometry);  
					//设置查询到的graphic的显示样式  
					graphic.setSymbol(symbol);  
					//把查询结果添加到map.graphics中进行显示  
					map.graphics.add(graphic);  

					var simpleMarkerSymbol1 = new esri.symbol.SimpleMarkerSymbol();
					var graphic1 = new esri.Graphic(point, simpleMarkerSymbol1);

					map.graphics.clear();
					map.graphics.add(graphic1);  
                

					//获取查询到的所有geometry的Extent用来设置查询后的地图显示  
					if(i == 0){  
						showExtent = fea.geometry.getExtent();  
					}else{  
						showExtent = showExtent.union(fea.geometry.getExtent());  
					}
				
					//设置地图的视图范围  
					map.setExtent(showExtent.expand(3));  
				}  
			});
		}
		
		//根据叠加判断需要显示的图层索引
		function getDjLayers(){
			var DjLayerCount=0;
			for(var i=0;i<Djlayers.length;i++){
				DjLayerCount++;
			}
			var tmpDjLayers=[];
			if (Djlayers.contains('历年批次')){
				tmpDjLayers.push('历年批次');
			}
			if (Djlayers.contains('城市规划')){
				tmpDjLayers.push('城市规划');
			}
			if (Djlayers.contains('土地规划')){
				tmpDjLayers.push('土地规划');
			}
			if (Djlayers.contains('土地现状')){
				tmpDjLayers.push('土地现状');
			}

			var layindexs=[];
			var dic_DjLayerAddrConfs=[];
			dic_DjLayerAddrConfs['历年批次']=[4,4,4,4];
			dic_DjLayerAddrConfs['城市规划']=[7,8,9,10];
			dic_DjLayerAddrConfs['土地规划']=[12,13,14,15];
			dic_DjLayerAddrConfs['土地现状']=[20,21,22,23];
			
			if (GridVisibleLayerDisp==true){//有影像
				if (DjLayerCount==1){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][1]);
				}
				else if (DjLayerCount == 2) {
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
				}
				else if (DjLayerCount==3){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[2];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
				}
				else if  (DjLayerCount==4){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[2];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[3];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
				}
			}
			else{//无影像
				if (DjLayerCount==1){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][0]);
				}
				else if (DjLayerCount==2){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][1]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][3]);
				}
				else if (DjLayerCount==3){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[2];
					layindexs.push(dic_DjLayerAddrConfs[layname][3]);
				}
				else if  (DjLayerCount==4){
					var layname=tmpDjLayers[0];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[1];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[2];
					layindexs.push(dic_DjLayerAddrConfs[layname][2]);
					layname=tmpDjLayers[3];
					layindexs.push(dic_DjLayerAddrConfs[layname][3]);
			
				}
			}
			return layindexs;
		}
	
		
		$(document).ready(function () {
		    var host = window.location.host;
		    if (host.substring(0, 9) == 'localhost') {
		        WebServer = 'http://' + host;
		    }
		    else {
		        WebServer = 'http://' + host+'/td_gis';
		    }
            initMap();
            document.onreadystatechange = completeLoading;

            setTimeout('InitPosition(2)', 2000);
            //企业定位不显示
            SetPosVisible(false);

		});
		function completeLoading() {

		    if (document.readyState == "complete") {
		        InitPosition(1);
		    }
		}
		Array.prototype.contains = function ( needle ) {
			for (i in this) {
				if (this[i] == needle) return true;
			}
			return false;
		}
		Array.prototype.indexOf = function (val) {
		    for (var i = 0; i < this.length; i++) {
		        if (this[i] == val) return i;
		    }
		    return -1;
		};

		Array.prototype.remove = function (val) {
		    var index = this.indexOf(val);
		    if (index > -1) {
		        this.splice(index, 1);
		    }
		};

		

    function targetto(url){
        $("#showModal").modal({
            remote: url
        });
    }


		//4.每次隐藏时，清除数据。确保点击时，重新加载
		$("#showModal").on("hidden.bs.modal", function() {
		    $(this).removeData("bs.modal");
		});


	</script>

         <script type="text/javascript">
             var circle = new Sonic({

                 width: 50,
                 height: 50,
                 padding: 50,

                 strokeColor: '#000',

                 pointDistance: .01,
                 stepsPerFrame: 3,
                 trailLength: .7,

                 step: 'fader',

                 setup: function () {
                     this._.lineWidth = 5;
                 },

                 path: [
                     ['arc', 125, 125, 25, 0, 360]
                 ]

             });
            
        </script>  
	<script>
	    function SubmitQueryLtd() {
	        var ltdname = $("#ltdname").val();
	        if ($.trim(ltdname) == "") {
	            alert("查询条件不能为空!");
	            return;
	        }
	        var tbody = ""; //声明表格中body部分 
	        //$.getJSON(WebServer + "/lyRemoteserv/JsLtdQuery", [{ ltdname: '孙' }], showresult)

			$.ajax({ //这里使用到Jquery的ajax方法
				type: "Get", 
				dataType: "json",   //dataType: 'jsonp',//crossDomain: true,
				url: WebServer + "/lyRemoteserv/JsLtdQuery", //请求的处理数据 
			    data: { ltdName: ltdname },
				success: function (data) {
				    try{
				        var testJson = data;//.serializeArray();// JSON.parse(json_string);// $.parseJSON(data);
				        //testJson = JSON.stringify(testJson);// testJson.stringify();
				       $("#LtdTable tr:gt(0)").remove();
				        for (var i = 0; i < testJson.length; i++) {
				            var trs = "";
				            trs += "<tr><td align='center'>" + (i + 1) + "</td><td>"
                            //trs += testJson[i].地块编码 + "</td><td>"
                            +'<a href="#" onclick="StartPosition('+"'"+testJson[i].dkbm +"'"+')">'+testJson[i].name+'</a>'
                                + ""+ "</td></tr>";
				            tbody += trs; 
				        }
				        $("#LtdTable").append(tbody);
				        //altRows('LtdTable');
				    }
				    catch (e) { alert(e);}
				}
			});

	    } 
	    function showresult(data) {
	        console.log(data);

	    }
		
    </script>
</head>

<body>
<div id="app"> 
 	<div id="container">
			    <div class="btn-group" role="group" style="float:right">
					    <!--<button type="button" class="btn btn-default" id="toggle-right">
						    <span class="glyphicon glyphicon-list-alt"></span>
					    </button>-->
					    <button id="btnTdxz" type="button" onclick="btnDispLayer(id,'土地现状')"  class="btn btn-default layerdisp">现</button>
					    <button id="btnFw" type="button" onclick="btnDispLayer(id,'房屋')" class="btn btn-default layernodisp">房</button>
					    <button id="btnLnpc" type="button" onclick="btnDispLayer(id,'历年批次')" class="btn btn-default  layernodisp">批</button>
					    <button id="btnTdgh" type="button" onclick="btnDispLayer(id,'土地规划')" class="btn btn-default layernodisp">土</button>
					    <button id="btnCsgh" type="button" onclick="btnDispLayer(id,'城市规划')" class="btn btn-default layernodisp">城</button>
				  	    <button id="btnYx" type="button" onclick="btnDispLayer(id,'影像')" class="btn btn-default layernodisp">影</button>
				  	    <!--<button id="Button1" type="button" onclick="MenuClick('401','土地现状')"class="btn btn-default">测试</button>
				-->
                       </div>
         <div id="map">	
           	     
			
		        </div>
        
            <!--<div data-role="widget" data-widget="nav4" class="nav4">//不触发map click-->
            <div  class="nav4">
	            <nav>
		            <div id="nav4_ul" class="nav_4" style="color:yellow">
			            <ul class="box">
				            <li>
					            <a href="javascript:;" class="" id="FunGroup1"><span>空间统计</span></a>
					            <dl>
						            <dd><a href="#"  class="menuitem"><span  onclick="MenuClick(id,'镇界')" id="101">镇统计</span></a></dd>
		                            <dd><a href="#" class="menuitem"><span   onclick="MenuClick(id,'村界')" id="102">村统计</span></a></dd>
					            </dl>
				            </li>
				            <li>
					       <!--     <a href="#"   data-toggle="modal" data-target="#PosLtd" ><span  onclick="MenuClick(id)" id="301">企业定位</span></a>
    			           --> 
                                  <a href="#"><span  onclick="MenuClick(id)" id="301">企业定位</span></a>
    			           
				            </li>
				            <li>
					            <a href="javascript:;" class="off" id="FunGroup4"><span>属性查询</span></a>
					            <dl>
                                    <dd>	<a href="#" class="menuitem"><span   onclick="MenuClick(id,'土地现状')" id="401">土地现状</span></a>	</dd>
						            <dd>	<a href="#" class="menuitem"><span onclick="MenuClick(id,'城市规划')" id="402">城市规划</span></a>	</dd>
						            <dd>	<a href="#" class="menuitem"><span onclick="MenuClick(id,'历年批次')" id="403">历年批次</span></a></dd>	
						          <!--  <dd>	<a href="#"><span  onclick="MenuClick(id,'土地规划')" id="404">土地规划</span></a></dd>	
						          -->  <dd>	<a href="#" class="menuitem"><span  onclick="MenuClick(id,'房屋')" id="405">房屋建筑</span></a></dd>	
					            </dl>
				            </li>
			
			            </ul>
		            </div>
	            </nav>
	
	           <!-- <div id="nav4_masklayer" class="masklayer_div on">&nbsp;</div>-->
                <script src="Scripts/QyTech/nav4.js"></script>
                <script type="text/javascript">
                    nav4.bindClick(document.getElementById("nav4_ul").querySelectorAll("li>a"), document.getElementById("nav4_masklayer"));
                </script>
            </div>



       </div>
	   <!-- <div class="modal fade" id="PosLtd">
			<div class="modal-dialog">
			    <div class="modal-content">-->
				    <div class="div100 title" id="LtdPos" style="display:none">
					<!--<form action="/lyRemote/AppLtdQuery" method="post">-->
							<div class="div100 yellow"><a href="javascript:" style="float:left"  onclick="SetPosVisible(false);"> <span class="btnReturn" style="color:white"> 返回 </span></a>企业名称:</div>
							<div class="div70">
								<div style="width: 70%; float: left;">
									<input type="text" style="color:black" name="ltdname" id="ltdname" value=""/>
								</div>
							</div>
							<div>
								<input id="postChange" style="width:15%;color:black" type="button" onclick="SubmitQueryLtd();" value="查询"/>
							</div>
						
					<!--</form>-->
					<div>
						<div id="content" class="div100">
							<table class="altrowstable" id="LtdTable" style="width:inherit">
								<thead>
									<tr style="background-color:#036C85;color:yellow;">
										<th ></th>
										<th style="text-align:center; vertical-align:middle">用地单位名称</th>
									</tr>
								</thead>
								<tbody>
									<tr> 
											
									</tr>
								</tbody>
							</table>
					    </div>
				    </div>
			   <!-- </div>
		    </div>
		</div>-->
     </div>


    <div id="div3th">

    </div>
  <!--  <!-- 模态框（Modal） 
    <a id="Dialog3th" data-toggle='modal'   data-target='#showModal' onclick=targetto(url)>asdfasdf</a>
    <div class="modal fade" id="showModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:900px;">
             <div class="modal-content">
                  
            </div>
        </div>
    </div>-->


</div> <!-- #app END -->
     	
    <script>
        circle.play();

        document.body.appendChild(circle.canvas);
        //document.onreadystatechange = completeLoading;
        //function completeLoading() {

        //    if (document.readyState == "complete") {

        //        document.body.removeChild(circle.canvas);
        //        //var loadingMask = document.getElementById(‘loadingDiv’);
        //        //loadingMask.parentNode.removeChild(loadingMask);

        //    }

        //}
        </script>
	</body>
</html>